# 用户故事地图 (User Story Map) - ClamGuard

---

### 1. 用户故事地图概述

*   **1.1 地图目的与使用说明**
    *   本用户故事地图旨在通过可视化的方式，展现 ClamGuard 的完整用户旅程和功能全景。它将作为产品待办事项列表 (Product Backlog) 的核心来源，并帮助团队就范围和优先级达成共识。
*   **1.2 用户类型定义**
    *   **开发者 (Developer)**: 需要在应用中集成病毒扫描功能的工程师。
    *   **运维工程师 (Operator)**: 负责部署、监控和维护本服务的技术人员。
*   **1.3 地图阅读指南**
    *   **横向轴 (用户活动流)**: 代表用户为了实现其目标而进行的一系列主要活动，从左到右构成一个完整的用户旅程。
    *   **纵向轴 (用户任务分解)**: 在每个主要活动下，是用户需要完成的具体任务（用户故事），按优先级从上到下排列。
    *   **发布版本切片 (Release Slices)**: 水平线划分出不同发布版本（MVP, v1.0等）所包含的用户故事范围。

---

### 2. 用户活动流 (Activities)

| 用户类型 | 探索与部署 (Explore & Deploy) | 集成与使用 (Integrate & Use) | 监控与管理 (Monitor & Manage) | 扩展与优化 (Scale & Optimize) |
| :--- | :--- | :--- | :--- | :--- |
| **开发者** | 发现项目 -> 理解API -> 运行服务 | **调用API扫描文件** -> 处理扫描结果 -> 调试异常 | 查看个人API调用日志 | 使用高级功能（异步/Webhook） |
| **运维** | 评估方案 -> **部署服务** -> 初始化配置 | (不直接参与) | **监控服务健康状况** -> **查询全局扫描日志** -> 管理引擎配置 | 扩展服务实例 -> 配置高可用 -> 集成监控系统 |

*(注：加粗的活动是最高优先级的核心用户旅程)*

---

### 3. 用户任务分解 (Tasks / User Stories)

#### 用户活动: **集成与使用 (Integrate & Use)**

| 任务 (User Story) | 优先级 | 复杂度 | 备注 |
| :--- | :--- | :--- | :--- |
| 作为开发者，我想要通过一个REST API同步上传文件并立即获得扫描结果。 | **P0** | 中 | 核心功能 |
| 作为开发者，我想要能处理清晰的API错误响应（如文件过大、超时）。 | **P0** | 低 | 保证可用性 |
| 作为开发者，我想要扫描服务器本地路径下的文件。 | **P1** | 低 | 增加灵活性 |
| 作为开发者，我想要异步提交大文件扫描，并通过Webhook接收结果。 | **P2** | 高 | v2.0 功能 |

---

#### 用户活动: **监控与管理 (Monitor & Manage)**

| 任务 (User Story) | 优先级 | 复杂度 | 备注 |
| :--- | :--- | :--- | :--- |
| 作为运维，我想要一个Web仪表盘来查看核心服务指标（扫描量、感染率）。 | **P0** | 中 | 核心功能 |
| 作为运维，我想要能查看ClamAV引擎的状态和病毒库版本。 | **P0** | 低 | 保证服务健康 |
| 作为运维，我想要为管理仪表盘设置登录密码。 | **P0** | 低 | v1.0 安全要求 |
| 作为运维，我想要查询详细的扫描历史日志，并能按结果/时间过滤。 | **P1** | 中 | v1.0 管理功能 |
| 作为运维，我想要通过`/metrics`端点将服务指标对接到Prometheus。 | **P1** | 中 | v1.0 运维集成 |
| 作为运维，我想要在Web界面上手动触发病毒库的更新。 | **P2** | 中 | 增强管理 |

---

#### 用户活动: **探索与部署 (Explore & Deploy)**

| 任务 (User Story) | 优先级 | 复杂度 | 备注 |
| :--- | :--- | :--- | :--- |
| 作为运维/开发者，我想要通过一个Dockerfile轻松地构建和运行服务。 | **P0** | 低 | 降低使用门槛 |
| 作为运维/开发者，我想要通过一个简单的配置文件来设置ClamAV地址和端口。 | **P0** | 低 | 保证可配置性 |
| 作为开发者，我想要阅读一份清晰的README，快速了解如何启动和调用API。 | **P1** | 低 | 提升开发者体验 |

---

### 4. 故事优先级与版本映射

#### **Release 1: MVP (v0.1.0)**

*   **目标**: 验证核心扫描与监控功能。
*   **包含的故事**: 
    *   (集成) 同步文件扫描API
    *   (集成) 清晰的API错误响应
    *   (监控) Web仪表盘展示核心指标
    *   (监控) 查看ClamAV引擎状态和病毒库版本
    *   (部署) Dockerfile一键部署
    *   (部署) 简单的配置文件

---

#### **Release 2: v1.0**

*   **目标**: 达到生产可用，增强安全和管理。
*   **包含的故事**: 
    *   *所有MVP功能*
    *   (监控) 管理仪表盘登录认证
    *   (监控) 详细的扫描历史日志查询
    *   (监控) Prometheus `/metrics` 端点集成
    *   (集成) 扫描服务器本地路径文件
    *   (部署) 清晰的README和API文档

---

#### **Release 3: v2.0 & Beyond (Backlog)**

*   **目标**: 扩展高级功能，构建生态。
*   **包含的故事**: 
    *   (集成) 异步扫描API与Webhook
    *   (监控) 手动触发病毒库更新
    *   (扩展) 支持多ClamAV后端与负载均衡
    *   (扩展) API Key认证与权限管理

---

### 5. 用户故事详述

*   **5.1 故事编写规范**
    *   遵循格式: “作为 **[用户类型]**，我想要 **[完成某事]**，以便 **[获得价值]**。”
*   **5.2 验收标准编写指南**
    *   每个故事都应附带清晰、可测试的验收标准 (AC)。
    *   例如，对于“同步文件扫描API”故事，AC可以是：
        1.  **Given** 一个干净的文件, **When** 我调用 `/api/v1/scan` 接口, **Then** 我收到 `200 OK` 响应，且响应体为 `{"status": "clean"}`。
        2.  **Given** 一个EICAR病毒文件, **When** 我调用 `/api/v1/scan` 接口, **Then** 我收到 `200 OK` 响应，且响应体包含 `"status": "infected"`。